<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>After School Club</title>

    <!-- Vue and FontAwesome links -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        header { display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 20px; background-color: #333; color: white; }
        main { width: 100%; max-width: 1200px; padding: 20px; }
        .product-grid { display: grid; gap: 20px; grid-template-columns: repeat(5, 1fr); }
        .product { border: 1px solid #ddd; border-radius: 8px; padding: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); text-align: center; }
        .product img { max-width: 100%; border-radius: 8px; }
        .product button { margin-top: 10px; padding: 10px 15px; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .product button:disabled { background-color: #ddd; cursor: not-allowed; }
        .cart-page { text-align: center; }
        .cart-item { display: grid;grid-template-columns: repeat(5, 1fr); flex-direction: column; align-items: center; margin-bottom: 20px; border: 1px solid #ddd; padding: 10px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
        .cart-item img { max-width: 100px; border-radius: 8px; margin-bottom: 10px; }
        .cart-controls { display: flex; align-items: center; gap: 5px; }
        .cart-controls button { padding: 5px 10px; font-size: 1em; }
        .form-field { margin: 10px 0; }
        .form-field label { display: block; margin-bottom: 5px; }
        .form-field input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .error { color: red; font-size: 0.9em; }
    </style>
</head>
<body>
    <div id="app">
        <!-- Header with Cart Button -->
        <header>
            <h1 v-text="sitename"></h1>

            <div>
            <label for="sortOptions">Sort by:</label>
            <select id="sortOptions" v-model="sortOptions" @change="sortProducts">
                <option value="available"> Classes Available</option>
                <option value="priceAsc">Price: Low to High</option>
                <option value="priceDesc">Price: High to Low</option>
            </select>
            </div>

            <button :disabled="cart.length === 0" @click="toggleCartView">
                <span v-if="cartItemCount">{{ cartItemCount }}</span>
                <span class="fas fa-cart-plus"></span> Checkout
            </button>
        </header>

        <!-- Products Page -->
        <main v-if="showProduct">
            <div class="product-grid">
                <div v-for="product in products" :key="product.id" class="product">
                    <img width="100" height="100" :src="product.image" alt="Product Image">
                    <h2 v-text="product.title"></h2>
                    <p v-html="product.description"></p>
                    <p>Price: ${{ product.price }}</p>
                    <p>Available: {{ product.availableInventory }}</p>
                    <button :disabled="!canAddToCart(product)" @click="addToCart(product)">
                        Add to cart
                    </button>
                </div>
            </div>
        </main>

        <!-- Cart Page -->
        <main v-if="!showProduct" class="cart-page">
            <h3>Your Cart</h3>
            <div v-if="cartDetails.length">
                <div v-for="item in cartDetails" :key="item.id" class="cart-item">
                    <img :src="item.image" alt="Product Image">
                    <h2 v-text="item.title"></h2>
                    <p v-html="item.description"></p>
                    <p>Price per unit: ${{ item.price }}</p>
                    <p>Total: ${{ item.price * item.quantity }}</p>
                    <p>Quantity: {{ item.quantity }}</p>
                    <div class="cart-controls">
                        <button @click="removeFromCart(item)">Remove</button>
                    </div>
                </div>
                <p>Total Cart Amount: ${{ cartTotal }}</p>

                <div class="form-field">
                    <label for="name">Name: </label>
                    <input type="text" id="name" v-model="customerName" @input="validateName" placeholder="Enter your name">
                    <p v-if="!customerName && attemptedCheckout" class="error"> Name is required</p>
                    <p v-if="nameError" class="error">Name must contain only letters and spaces.</p>
                </div>

                <div class="form-field">
                    <label for="phone">Phone number: </label>
                    <input type="tel" id="phone" v-model="customerPhone" placeholder="Enter your phone number">
                    <p v-if="!customerPhone && attemptedCheckout" class="error"> Phone number is required</p>
                    <p v-if="phoneError && customerPhone" class="error">Phone number must contain only digits.</p>
                </div>

                <button @click="checkout" :disabled="cart.length === 0">Proceed to Checkout</button>
            </div>
            <div v-else>
                <p>Your cart is empty.</p>
            </div>
            <button @click="toggleCartView">Back to Products</button>
        </main>
    </div>

    <!-- Vue JS for Functionality -->
    <script>
        let webstore = new Vue({
            el: '#app',
            data: {
                sitename: 'After School Club',
                showProduct: true,
                products: [
                    { id: 1001, title: "Art class", description: "1 Hour of art class", price: 64, image: "images/art.jpg", availableInventory: 5 },
                    { id: 1002, title: "Music class", description: "1 Hour of music theory", price: 60, image: "images/music.jpg", availableInventory: 3 },
                    { id: 1003, title: "Math class", description: "1 Hour of Math class", price: 70, image: "images/math.jpg", availableInventory: 2 },
                    { id: 1004, title: "History class", description: "1 Hour of History", price: 75, image: "images/history.jpg", availableInventory: 1 },
                    { id: 1005, title: "Science class", description: "1 Hour of Science", price: 80, image: "images/science.jpg", availableInventory: 0 },
                    { id: 1006, title: "Geography class", description: "1 Hour of Geography", price: 65, image: "images/Geo.jpg", availableInventory: 5 },
                    { id: 1007, title: "Arabic class", description: "1 Hour of Arabic tutoring", price: 68, image: "images/arabic.jpg", availableInventory: 3 },
                    { id: 1008, title: "Coding class", description: "1 Hour of coding basics", price: 90, image: "images/coding.jpg", availableInventory: 4 },
                    { id: 1009, title: "Robotics class", description: "1 Hour of robotics", price: 85, image: "images/robotics.jpg", availableInventory: 1 },
                    { id: 1010, title: "Economics class", description: "1 Hour of Economics", price: 95, image: "images/economics.jpg", availableInventory: 4 }
                ],
                cart: [],
                customerName: '',
                customerPhone: '',
                attemptedCheckout: false,
                phoneError: false,
                sortOptions: 'available',
            },
            methods: {
                toggleCartView() {
                    this.showProduct = !this.showProduct;
                },
                addToCart(product) {
                    product.availableInventory--;
                    this.cart.push(product.id);
                },
                removeFromCart(item) {
                    this.cart = this.cart.filter(id => id !== item.id);
                    const product = this.products.find(p => p.id === item.id);
                    if (product) {
                        product.availableInventory += item.quantity;
                    }
                },
                sortProducts(){
                    if (this.sortOptions === 'available'){
                        this.products.sort((a, b) => b.availableInventory - a.availableInventory);
                    } else if (this.sortOptions === 'priceAsc'){
                        this.products.sort((a, b) => a.price - b.price);
                    } else if (this.sortOptions === 'priceDesc'){
                        this.products.sort((a, b) => b.price - a.price);
                    }
                },
                validatePhone() {
                // Allow only numbers
                    const phoneRegex = /^[0-9]+$/;
                    this.phoneError = !phoneRegex.test(this.customerPhone);
                },
                validateName() {
                // Allow only letters (a-z, A-Z) and spaces
                    const nameRegex = /^[a-zA-Z\s]*$/;
                    if (!nameRegex.test(this.customerName)) {
                        this.nameError = "Name must contain only letters and spaces.";
                    } else {
                        this.nameError = ""; // Clear error if the name is valid
                    }
                },

                checkout() {
                    this.attemptedCheckout = true;
                    this.validatePhone();
                    this.validateName();

                    if (this.customerName && !this.nameError && !this.phoneError){
                        alert(`Thank you for your purchase, ${this.customerName}!`);
                        this.cart = [];
                        this.customerName = '';
                        this.customerPhone = '';
                        this.products.forEach(product => product.availableInventory = product.availableInventory);
                        this.toggleCartView();
                    } else {
                        if(!this.customerName){
                            alert("Please provide your name.");
                        }
                        if(this.nameError){
                            alert(this.nameError);
                        }
                        if(this.phoneError){
                            alert("phone number must contain only numbers.")
                        }
                    }
                }
            },
            computed: {
                cartItemCount() {
                    return this.cart.length || "";
                },
                cartDetails() {
                    return this.products
                        .filter(product => this.cart.includes(product.id))
                        .map(product => ({
                            ...product,
                            quantity: this.cart.filter(id => id === product.id).length
                        }));
                },
                cartTotal() {
                    return this.cartDetails.reduce((total, item) => total + item.price * item.quantity, 0);
                },
                canAddToCart() {
                    return (product) => product.availableInventory > 0;
                }
            },
        });
    </script>
</body>
</html>
